<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.vk.article.mapper.ApArticleMapper">


    <resultMap id="articleDocumentResultMap" type="com.vk.common.es.domain.ArticleInfoDocument">
        <result property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="authorId" column="author_id"/>
        <result property="authorName" column="author_name"/>
        <result property="channelId" column="channel_id"/>
        <result property="channelName" column="channel_name"/>
        <result property="layout" column="layout"/>
        <result property="images" column="images"/>
        <result property="likes" column="likes"/>
        <result property="collection" column="collection"/>
        <result property="comment" column="comment"/>
        <result property="views" column="views"/>
        <result property="createdTime" column="created_time"/>
        <result property="publishTime" column="publish_time"/>
        <result property="isDown" column="is_down"/>
        <result property="isDelete" column="is_delete"/>
    </resultMap>

    <select id="getArticleData" resultType="com.vk.article.domain.vo.ArticleDataVo">
        SELECT
            COALESCE(COUNT(*), 0) AS 'release',
                COALESCE(SUM(likes), 0) AS 'like',
                COALESCE(SUM(collection), 0)   AS 'collect',
                COALESCE(SUM(views), 0) AS 'views'
        FROM ap_article
        WHERE author_id = #{userId} and  status = 9 and update_time >= #{startTime} and update_time &lt;= #{endTime}  ;
    </select>

    <select id="getArticleInfoData" resultType="com.vk.article.domain.vo.ArticleData">
        SELECT
            id,
            title,
            likes,
            collection as collect,
            views,
            comment
        FROM ap_article
        WHERE author_id = #{userId}  and status = 9  ORDER BY update_time desc limit #{page}, #{size} ;
    </select>

    <select id="selectByPage" resultMap="articleDocumentResultMap">
        select apa.id,
               apa.title,
               apa.author_id,
               apa.author_name,
               apa.channel_id,
               apa.channel_name,
               apa.layout,
               apa.images,
               apa.likes,
               apa.collection,
               apa.comment,
               apa.views,
               apa.created_time,
               apa.publish_time,
               apc.is_down,
               apc.is_delete
        from ap_article apa
                 inner join ap_article_config apc on
            apa.id = apc.article_id
        where apa.publish_time &lt;= #{publishTime}
            limit #{start}, #{size}
    </select>

    <select id="selectForCondition" resultMap="articleDocumentResultMap">
        select apa.id,
               apa.title,
               apa.author_id,
               apa.author_name,
               apa.channel_id,
               apa.channel_name,
               apa.layout,
               apa.images,
               apa.likes,
               apa.collection,
               apa.comment,
               apa.views,
               apa.created_time,
               apa.publish_time,
               apc.is_down,
               apc.is_delete
        from ap_article apa
                 inner join ap_article_config apc on apa.id = apc.article_id
        where publish_time > #{redisTime}
          and publish_time &lt;= #{nowTime}
    </select>
</mapper>
